<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Metadata Galería</title>
<style>
  body { font-family: sans-serif; padding: 20px; max-width: 500px; margin: auto; }
  label { display: block; margin-top: 10px; }
  input, select, textarea { width: 100%; padding: 6px; box-sizing: border-box; }
  button { margin-top: 10px; padding: 10px; }
  .mensaje { margin-top: 10px; color: green; }
  table { margin-top: 20px; width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
</style>
</head>
<body>

<h2>Editar metadata de imágenes</h2>

<form id="formMetadata">
  <label>ID imagen (ej. 001): <input type="text" id="id" required pattern="\d{3}" title="Introduce un número de 3 dígitos, ejemplo: 001" />

  
  <label>Categorías (selecciona una o más): 
    <select id="categorias" multiple size="3" required>
      <option value="Terror">Terror</option>
      <option value="Ciencia Ficción">Ciencia Ficción</option>
      <option value="Oscuras">Oscuras</option>
    </select>
  </label>
  
  <label>Año: <input type="number" id="anio" min="1900" max="3500" /></label>
  <label>Fecha publicación (YYYY-MM-DD): <input type="date" id="fecha" /></label>
  <label>Título: <input type="text" id="titulo" /></label>
  <button type="submit">Guardar metadata</button>
</form>

<div class="mensaje" id="mensaje"></div>

<h3>Metadata guardada</h3>
<table id="tablaMetadata">
  <thead><tr><th>ID</th><th>Categorías</th><th>Año</th><th>Fecha</th><th>Título</th><th>Acciones</th></tr></thead>
  <tbody></tbody>
</table>

<script>
  const form = document.getElementById('formMetadata');
  const mensaje = document.getElementById('mensaje');
  const tablaBody = document.querySelector('#tablaMetadata tbody');

  function cargarMetadata() {
    let data = localStorage.getItem('metadataGaleria');
    return data ? JSON.parse(data) : {};
  }

  function guardarMetadata(data) {
    localStorage.setItem('metadataGaleria', JSON.stringify(data));
  }

  function mostrarTabla() {
    const data = cargarMetadata();
    tablaBody.innerHTML = '';
    for (const id in data) {
      const item = data[id];
      const categoriasStr = item.categorias.join(', ');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${id}</td>
        <td>${categoriasStr}</td>
        <td>${item.anio || ''}</td>
        <td>${item.fecha || ''}</td>
        <td>${item.titulo || ''}</td>
        <td><button data-id="${id}" class="borrarBtn">Borrar</button></td>
      `;
      tablaBody.appendChild(tr);
    }
    // Botones borrar
    document.querySelectorAll('.borrarBtn').forEach(btn => {
      btn.onclick = () => {
        const id = btn.getAttribute('data-id');
        const data = cargarMetadata();
        delete data[id];
        guardarMetadata(data);
        mostrarTabla();
      };
    });
  }

  form.onsubmit = e => {
    e.preventDefault();
    const id = form.id.value.trim();
    const selectedOptions = [...form.categorias.options].filter(o => o.selected);
    const categorias = selectedOptions.map(o => o.value);
    const anio = form.anio.value ? parseInt(form.anio.value) : null;
    const fecha = form.fecha.value;
    const titulo = form.titulo.value.trim();

    const data = cargarMetadata();
    data[id] = { categorias, anio, fecha, titulo };
    guardarMetadata(data);

    mensaje.textContent = `Metadata para imagen ${id} guardada.`;
    form.reset();
    mostrarTabla();
  };

  mostrarTabla();
</script>

</body>
</html>
